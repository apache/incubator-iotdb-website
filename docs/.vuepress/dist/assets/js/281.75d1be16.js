(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{370:function(t,_,v){"use strict";v.r(_);var a=v(1),e=Object(a.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),v("p",[t._v("宽表结构：Tsfile原生格式，IOTDB原生路径格式")]),t._v(" "),t._m(4),t._v(" "),v("p",[t._v("窄表结构: 关系型数据库模式，IOTDB align by device格式")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),v("p",[t._v("该步骤是为了使DataFrame的表结构与需要查询的Tsfile的表结构匹配\n主要逻辑在src/main/scala/org/apache/iotdb/spark/tsfile/DefaultSource.scala中的inferSchema函数")]),t._v(" "),t._m(8),t._v(" "),v("p",[t._v("该步骤目的是为了将用户SQL语句转化为Tsfile原生的查询表达式")]),t._v(" "),v("p",[t._v("主要逻辑在src/main/scala/org/apache/iotdb/spark/tsfile/DefaultSource.scala中的buildReader函数")]),t._v(" "),v("p",[t._v("SQL解析分宽表结构与窄表结构")]),t._v(" "),t._m(9),t._v(" "),v("p",[t._v("宽表结构的SQL解析主要逻辑在src/main/scala/org/apache/iotdb/spark/tsfile/WideConverter.scala中")]),t._v(" "),v("p",[t._v("该结构与Tsfile原生查询结构基本相同，不需要特殊处理，直接将SQL语句转化为相应查询表达式即可")]),t._v(" "),t._m(10),t._v(" "),v("p",[t._v("宽表结构的SQL解析主要逻辑在src/main/scala/org/apache/iotdb/spark/tsfile/NarrowConverter.scala中")]),t._v(" "),v("p",[t._v("SQL转化为表达式后，由于窄表结构与Tsfile原生查询结构不同，需要先将表达式转化为与device有关的析取表达式\n，才可以转化为对Tsfile的查询，转化代码在src/main/java/org/apache/iotdb/spark/tsfile/qp中")]),t._v(" "),t._m(11),t._v(" "),v("p",[t._v("实际数据查询执行由Tsfile原生组件完成，参见：")]),t._v(" "),v("ul",[v("li",[v("router-link",{attrs:{to:"./../1-TsFile/4-Read.html"}},[t._v("Tsfile原生查询流程")])],1)]),t._v(" "),t._m(12),t._v(" "),v("p",[t._v("写入主要是将Dataframe结构中的数据转化为Tsfile的RowRecord，使用Tsfile Writer进行写入")]),t._v(" "),t._m(13),t._v(" "),v("p",[t._v("其主要转化代码在如下两个文件中：")]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),v("p",[t._v("其主要转化代码在如下两个文件中：")]),t._v(" "),t._m(16)])}),[function(){var t=this.$createElement,_=this._self._c||t;return _("h1",{attrs:{id:"spark-tsfile-连接器"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#spark-tsfile-连接器"}},[this._v("#")]),this._v(" Spark Tsfile 连接器")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"设计目的"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#设计目的"}},[this._v("#")]),this._v(" 设计目的")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("使用Spark SQL读取指定Tsfile的数据，以Spark DataFrame的形式返回给客户端")])]),this._v(" "),_("li",[_("p",[this._v("使用Spark Dataframe中的数据生成Tsfile")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"支持格式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#支持格式"}},[this._v("#")]),this._v(" 支持格式")])},function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("table",[v("thead",[v("tr",[v("th",[t._v("time")]),t._v(" "),v("th",[t._v("root.ln.wf02.wt02.temperature")]),t._v(" "),v("th",[t._v("root.ln.wf02.wt02.status")]),t._v(" "),v("th",[t._v("root.ln.wf02.wt02.hardware")]),t._v(" "),v("th",[t._v("root.ln.wf01.wt01.temperature")]),t._v(" "),v("th",[t._v("root.ln.wf01.wt01.status")]),t._v(" "),v("th",[t._v("root.ln.wf01.wt01.hardware")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("2.2")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("false")]),t._v(" "),v("td",[t._v("aaa")]),t._v(" "),v("td",[t._v("2.2")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("3")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("2.1")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("4")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("bbb")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("5")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("false")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("6")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("ccc")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")])])])])},function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("table",[v("thead",[v("tr",[v("th",[t._v("time")]),t._v(" "),v("th",[t._v("device_name")]),t._v(" "),v("th",[t._v("status")]),t._v(" "),v("th",[t._v("hardware")]),t._v(" "),v("th",[t._v("temperature")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("2.2")])]),t._v(" "),v("tr",[v("td",[t._v("1")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("2.2")])]),t._v(" "),v("tr",[v("td",[t._v("2")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),v("td",[t._v("false")]),t._v(" "),v("td",[t._v("aaa")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("3")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("2.1")])]),t._v(" "),v("tr",[v("td",[t._v("4")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),v("td",[t._v("true")]),t._v(" "),v("td",[t._v("bbb")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("5")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt01")]),t._v(" "),v("td",[t._v("false")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("null")])]),t._v(" "),v("tr",[v("td",[t._v("6")]),t._v(" "),v("td",[t._v("root.ln.wf02.wt02")]),t._v(" "),v("td",[t._v("null")]),t._v(" "),v("td",[t._v("ccc")]),t._v(" "),v("td",[t._v("null")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"查询流程步骤"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#查询流程步骤"}},[this._v("#")]),this._v(" 查询流程步骤")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_1-表结构推断和生成"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构推断和生成"}},[this._v("#")]),this._v(" 1. 表结构推断和生成")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-sql解析"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-sql解析"}},[this._v("#")]),this._v(" 2. SQL解析")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_3-宽表结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-宽表结构"}},[this._v("#")]),this._v(" 3. 宽表结构")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-窄表结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-窄表结构"}},[this._v("#")]),this._v(" 4. 窄表结构")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_5-查询实际执行"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-查询实际执行"}},[this._v("#")]),this._v(" 5. 查询实际执行")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"写入步骤流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#写入步骤流程"}},[this._v("#")]),this._v(" 写入步骤流程")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"宽表结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#宽表结构"}},[this._v("#")]),this._v(" 宽表结构")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/WideConverter.scala 负责结构转化")])]),this._v(" "),_("li",[_("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/WideTsFileOutputWriter.scala 负责匹配spark接口与执行写入，会调用上一个文件中的结构转化功能")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"窄表结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#窄表结构"}},[this._v("#")]),this._v(" 窄表结构")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/NarrowConverter.scala 负责结构转化")])]),this._v(" "),_("li",[_("p",[this._v("src/main/scala/org/apache/iotdb/spark/tsfile/NarrowTsFileOutputWriter.scala 负责匹配spark接口与执行写入，会调用上一个文件中的结构转化功能")])])])}],!1,null,null,null);_.default=e.exports}}]);